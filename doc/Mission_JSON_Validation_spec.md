# ğŸ§© **A. Mission JSON Validation è¨­è¨ˆ**

Mission JSON ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½ã¯ã€ãƒŸãƒƒã‚·ãƒ§ãƒ³èª­ã¿è¾¼ã¿æ™‚ã«ä»¥ä¸‹ã‚’ä¿è¨¼ã™ã‚‹ã“ã¨ãŒç›®çš„ã§ã™ï¼š

* JSONæ§‹é€ ãŒä»•æ§˜ã«é©åˆã—ã¦ã„ã‚‹
* å‹ã‚„ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒæ­£ã—ã„
* é‡è¤‡ã‚„çŸ›ç›¾ãŒãªã„
* ãƒŸãƒƒã‚·ãƒ§ãƒ³å®Ÿè¡Œã«å¿…è¦ãªæƒ…å ±ãŒæƒã£ã¦ã„ã‚‹
* ã‚¨ãƒ©ãƒ¼å†…å®¹ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ï¼†é–‹ç™ºè€…ã«æ˜ç¢ºã«è¿”ã™

ã“ã‚Œã«ã‚ˆã‚Šã€ãƒŸãƒƒã‚·ãƒ§ãƒ³è¿½åŠ ã®æ•·å±…ãŒä¸‹ãŒã‚Šã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå£Šã‚ŒãŸãƒŸãƒƒã‚·ãƒ§ãƒ³ã«é­é‡ã—ãªããªã‚Šã¾ã™ã€‚

---

# 1. Validation å…¨ä½“ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
MissionLoader
   â””â”€â”€ MissionValidator
		 â”œâ”€â”€ SchemaValidatorï¼ˆã‚­ãƒ¼æ§‹é€ ï¼‰
		 â”œâ”€â”€ TypeValidatorï¼ˆå‹ç¢ºèªï¼‰
		 â”œâ”€â”€ FilesystemValidator
		 â”œâ”€â”€ ServerValidator
		 â”œâ”€â”€ NetworkValidator
		 â”œâ”€â”€ GoalValidator
		 â””â”€â”€ CrossValidatorï¼ˆé‡è¤‡ãƒ»çŸ›ç›¾ãƒã‚§ãƒƒã‚¯ï¼‰
```

**ãƒã‚¤ãƒ³ãƒˆï¼šæ‹¡å¼µå¯èƒ½ãªè¨­è¨ˆã«ã—ã¦ã‚ã‚‹ãŸã‚ã€A ã®å¾Œã« Dï¼ˆãƒ‘ã‚±ãƒƒãƒˆã‚„FSï¼‰ã‚’è¿½åŠ ã—ã¦ã‚‚ç ´ç¶»ã—ãªã„ã€‚**

Godotã§ã¯ autoload (singleton) ã® `mission_validator.gd` ã¨ã—ã¦ç®¡ç†ã§ãã¾ã™ã€‚

---

# 2. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³é …ç›®ä¸€è¦§

ä»¥ä¸‹ã¯ *å¿…é ˆãƒã‚§ãƒƒã‚¯é …ç›®* ã¨ã—ã¦å®Ÿè£…ã™ã¹ãé …ç›®ã§ã™ã€‚

---

## 2.1 ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«

| é …ç›®                | æ¡ä»¶                 |
| ----------------- | ------------------ |
| `mission_id`      | string / not empty |
| `title`           | string / not empty |
| `description`     | string             |
| `difficulty`      | int / 1ã€œ5          |
| `user_filesystem` | object             |
| `servers`         | array / length â‰¥ 1 |
| `goals`           | object             |

---

## 2.2 Filesystem

### å…±é€šãƒ«ãƒ¼ãƒ«

| ãƒ«ãƒ¼ãƒ«                    | èª¬æ˜                       |
| ---------------------- | ------------------------ |
| `path` ã¯ "/" ã‹ã‚‰å§‹ã¾ã‚‹     | UNIXç³»æº–æ‹                   |
| åŒã˜ path ãŒé‡è¤‡ç¦æ­¢          | ä¾‹ï¼š2ã¤ã® `/home/user/a.txt` |
| `type` ã¯ç™»éŒ²æ¸ˆã¿ã®ã¿         | text, log, pcap, binary  |
| generator ã®å‹ã¯å­˜åœ¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ | Noiseç”Ÿæˆç³»ã§ä½¿ã†              |
| directory ã®è‡ªå‹•ç”Ÿæˆã¯ã—ãªã„    | JSONã«æ˜ç¤ºã™ã‚‹ï¼ˆãƒã‚°ã®åŸå› ã‚’é˜²ãï¼‰      |

---

## 2.3 Servers

### ãƒ«ãƒ¼ãƒ«

| ãƒ«ãƒ¼ãƒ«                              | èª¬æ˜                |
| -------------------------------- | ----------------- |
| `id` ã¯å…¨ä½“ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯                    | `web01` ãŒ2å›å‡ºãŸã‚‰ã‚¨ãƒ©ãƒ¼ |
| `type` ã¯ç™»éŒ²ã‚µãƒ¼ãƒãƒ¼ç¨®åˆ¥ã®ã¿               | web, app, file ãªã© |
| ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã®æ§‹é€ ã¯ user FS ã¨åŒã˜ãƒãƒªãƒ‡ãƒ¼ã‚¿ã§æ¤œè¨¼ | DRY åŸå‰‡            |
| network å®šç¾©ãŒæœªå®šç¾©ãªã‚‰ã‚¨ãƒ©ãƒ¼              | NICãŒ0ã®ã‚µãƒ¼ãƒãƒ¼ã¯å­˜åœ¨ã§ããªã„ |

---

## 2.4 Network

### Interface

| ãƒ«ãƒ¼ãƒ«          | èª¬æ˜                                   |
| ------------ | ------------------------------------ |
| name ã¯ãƒ¦ãƒ‹ãƒ¼ã‚¯   | ã‚µãƒ¼ãƒãƒ¼å†…ã§é‡è¤‡ç¦æ­¢                           |
| IPv4å½¢å¼ã‚’æ¤œè¨¼    | æ­£è¦è¡¨ç¾ï¼š`^([0-9]{1,3}\.){3}[0-9]{1,3}$` |
| ãƒãƒ¼ãƒˆã¯ 1ã€œ65535 | é…åˆ—å†…ã®é‡è¤‡ã‚‚ç¦æ­¢                            |

---

## 2.5 Goals

| ãƒ«ãƒ¼ãƒ«                      | èª¬æ˜                  |
| ------------------------ | ------------------- |
| flag ãŒ string            | FLAG{...} å½¢å¼ã¯æ¨å¥¨ï¼ˆä»»æ„ï¼‰ |
| è¤‡æ•°ã‚´ãƒ¼ãƒ«è¿½åŠ ã«å‚™ãˆã¦ object ã¨ã—ã¦è¨­è¨ˆ | v2.0æ‹¡å¼µã®ãŸã‚           |

---

## 2.6 ã‚¯ãƒ­ã‚¹ãƒã‚§ãƒƒã‚¯ï¼ˆCross Validationï¼‰

ã“ã“ãŒæœ€é‡è¦ã€‚

| ãƒã‚§ãƒƒã‚¯                           | èª¬æ˜             |
| ------------------------------ | -------------- |
| åŒä¸€IPã‚’æŒã¤è¤‡æ•°ã‚µãƒ¼ãƒãƒ¼ã¯åŒä¸€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«å­˜åœ¨ã§ãã‚‹ã‹ï¼Ÿ | è¨­è¨ˆæ¬¡ç¬¬ã ãŒåŸºæœ¬OK     |
| åŒä¸€ãƒãƒ¼ãƒˆã‚’åŒä¸€IPã§è¤‡æ•°ã‚µãƒ¼ãƒãƒ¼ãŒ LISTEN ã¯ã‚¨ãƒ©ãƒ¼ | ç«¶åˆãƒã‚§ãƒƒã‚¯         |
| FSã§ user ã¨ server ã® path è¡çªã¯è¨±å®¹ | åå‰ç©ºé–“ãŒåˆ¥ã®ãŸã‚OK    |
| server æ•°ãŒ 1 ä»¥ä¸‹ãªã‚‰ Warning       | CTFã¨ã—ã¦æˆç«‹ã—ãªã„å¯èƒ½æ€§ |

---

# 3. ã‚¨ãƒ©ãƒ¼åˆ†é¡

ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ã¯ç¨®é¡ã‚’æ˜ç¢ºã«è¨­è¨ˆã™ã‚‹ã€‚

### Error Category

| ã‚«ãƒ†ã‚´ãƒª                | èª¬æ˜            |
| ------------------- | ------------- |
| `STRUCTURE_ERROR`   | å¿…é ˆã‚­ãƒ¼æ¬ è½        |
| `TYPE_ERROR`        | å‹ãŒæ­£ã—ããªã„       |
| `FORMAT_ERROR`      | IPã‚„ãƒ‘ã‚¹ãªã©ã®æ›¸å¼ã‚¨ãƒ©ãƒ¼ |
| `DUPLICATE_ERROR`   | é‡è¤‡            |
| `CONFLICT_ERROR`    | ãƒãƒ¼ãƒˆç«¶åˆãªã©       |
| `UNSUPPORTED_ERROR` | æœªçŸ¥ã®ã‚µãƒ¼ãƒãƒ¼ç¨®åˆ¥ãªã©   |
| `GENERATOR_ERROR`   | ãƒã‚¤ã‚ºç”Ÿæˆãƒ«ãƒ¼ãƒ«ã®ã‚¨ãƒ©ãƒ¼  |

### Error Object Format

```json
{
  "category": "DUPLICATE_ERROR",
  "path": "servers[1].id",
  "message": "Server ID 'web01' is duplicated."
}
```

ã‚¢ãƒ—ãƒªå†…ã§ã¯ list ã¨ã—ã¦ä¿æŒã—ã€èª­ã¿è¾¼ã¿æ™‚ã«ã¾ã¨ã‚ã¦ UI ã«è¡¨ç¤ºã—ã¾ã™ã€‚

---

# 4. Validation å®Ÿè£…æ§‹æˆï¼ˆGodotï¼‰

`res://engine/validation/mission_validator.gd`

```
MissionValidator
 â”œâ”€â”€ validate(json: Dictionary) -> ValidationReport
 â”œâ”€â”€ _validate_structure()
 â”œâ”€â”€ _validate_types()
 â”œâ”€â”€ _validate_filesystem()
 â”œâ”€â”€ _validate_servers()
 â”œâ”€â”€ _validate_network()
 â”œâ”€â”€ _validate_goals()
 â””â”€â”€ _validate_cross()
```

---

# 5. ValidationReport ä»•æ§˜

```gdscript
class_name ValidationReport

var valid: bool
var errors: Array  # Array[ValidationError]

func add_error(category: String, path: String, message: String):
	errors.append({
		"category": category,
		"path": path,
		"message": message
	})
```

ã‚¨ãƒ©ãƒ¼ãŒ 0 ä»¶ãªã‚‰ `valid = true`ã€‚

---
